

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Webcam Example &mdash; Robot Raconteur Python  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Service Discovery" href="Discovery.html" />
    <link rel="prev" title="iRobot Create Python Example" href="iRobotCreatePythonExample.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Robot Raconteur Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ServiceDefinition.html">Service Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="RobotRaconteurPython.html">Robot Raconteur Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="iRobotCreatePythonExample.html">iRobot Create Python Example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Webcam Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#webcam-service">Webcam Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#webcam-client">Webcam Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#webcam-client-streaming">Webcam Client (streaming)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#webcam-client-memory">Webcam Client (memory)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Discovery.html">Service Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="Subscriptions.html">Subscriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="ObjectLocks.html">Exclusive object locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeCritical.html">Time-critical software with Wire member</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForwardCompatibility.html">Forward compatibility with the “implements” statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="MemberModifiers.html">Member Modifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Async.html">Asynchronous programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="GatherScatter.html">Gather/Scatter operations</a></li>
</ul>
<p class="caption"><span class="caption-text">Framework:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/service_definition.html">Service Definitions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/nodes_and_communication.html">Robot Raconteur Nodes and Communication</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/locking.html">Object Locking</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/command_line_options.html">Node Setup Command Line Options</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/taps.html">Taps</a></li>
<li class="toctree-l1"><a class="reference external" href="https://robotraconteur.github.io/robotraconteur/doc/core/latest/cpp/robotraconteurgen.html">RobotRaconteurGen Utility</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/Constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/RobotRaconteurNode.html">RobotRaconteurNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/DataTypes.html">Misc Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/PipeMember.html">Pipe Member</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/WireMember.html">Wire Member</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/CallbackMember.html">Callback Member</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Subscription.html">Subscription</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/NodeSetup.html">Node Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Transports.html">Transports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Timers.html">Timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Service.html">Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/ServiceSecurity.html">Service Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/Logging.html">Logging and Taps</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Robot Raconteur Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Webcam Example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/WebcamPythonExample.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="webcam-example">
<h1>Webcam Example<a class="headerlink" href="#webcam-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="webcam-service">
<h2>Webcam Service<a class="headerlink" href="#webcam-service" title="Permalink to this headline">¶</a></h2>
<p>The example robot also has webcams that can be accessed using the Python OpenCV libraries. Example
<a class="reference external" href="https://github.com/robotraconteur/RobotRaconteur_Python_Examples/blob/master/SimpleWebcamService.py">SimpleWebcamService.py</a>
on GitHub is a program that exposes the webcams as a Robot Raconteur
service. The example is intended to demonstrate the usage of the “objref”, “pipe”, and “memory” members that were not
used in the iRobot Create examples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Service to provide sample interface to webcams</span>
<span class="n">service</span> <span class="n">experimental</span><span class="o">.</span><span class="n">createwebcam2</span>

<span class="n">stdver</span> <span class="mf">0.9</span>

<span class="n">struct</span> <span class="n">WebcamImage</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">width</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">height</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">step</span>
    <span class="n">field</span> <span class="n">uint8</span><span class="p">[]</span> <span class="n">data</span>
<span class="n">end</span>

<span class="n">struct</span> <span class="n">WebcamImage_size</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">width</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">height</span>
    <span class="n">field</span> <span class="n">int32</span> <span class="n">step</span>
<span class="n">end</span>

<span class="nb">object</span> <span class="n">Webcam</span>
    <span class="nb">property</span> <span class="n">string</span> <span class="n">Name</span> <span class="p">[</span><span class="n">readonly</span><span class="p">]</span>
    <span class="n">function</span> <span class="n">WebcamImage</span> <span class="n">CaptureFrame</span><span class="p">()</span>

    <span class="n">function</span> <span class="n">void</span> <span class="n">StartStreaming</span><span class="p">()</span>
    <span class="n">function</span> <span class="n">void</span> <span class="n">StopStreaming</span><span class="p">()</span>
    <span class="n">pipe</span> <span class="n">WebcamImage</span> <span class="n">FrameStream</span> <span class="p">[</span><span class="n">readonly</span><span class="p">]</span>

    <span class="n">function</span> <span class="n">WebcamImage_size</span> <span class="n">CaptureFrameToBuffer</span><span class="p">()</span>
    <span class="n">memory</span> <span class="n">uint8</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">[</span><span class="n">readonly</span><span class="p">]</span>
    <span class="n">memory</span> <span class="n">uint8</span><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">multidimbuffer</span> <span class="p">[</span><span class="n">readonly</span><span class="p">]</span>

<span class="n">end</span>

<span class="nb">object</span> <span class="n">WebcamHost</span>
    <span class="nb">property</span> <span class="n">string</span><span class="p">{</span><span class="n">int32</span><span class="p">}</span> <span class="n">WebcamNames</span> <span class="p">[</span><span class="n">readonly</span><span class="p">]</span>
    <span class="n">objref</span> <span class="n">Webcam</span><span class="p">{</span><span class="n">int32</span><span class="p">}</span> <span class="n">Webcams</span>
<span class="n">end</span>
</pre></div>
</div>
<p>The service definition for the <code class="docutils literal notranslate"><span class="pre">experimental.createwebcam2</span></code> shown in above
contains two objects: <code class="docutils literal notranslate"><span class="pre">WebcamHost</span></code> and <code class="docutils literal notranslate"><span class="pre">Webcam</span></code>. The <code class="docutils literal notranslate"><span class="pre">Webcam</span></code> object type represents a single camera, and the
<code class="docutils literal notranslate"><span class="pre">WebcamHost</span></code> object allows for the client to determine the number of webcams and retrieve the <code class="docutils literal notranslate"><span class="pre">Webcam</span></code> objects
through an “objref” member.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">WebcamHost_impl</span></code> implements the <code class="docutils literal notranslate"><span class="pre">WebcamHost</span></code> object type. The function <code class="docutils literal notranslate"><span class="pre">WebcamNames</span></code> returns a map of
the indexes and names of the cameras, and is an example of the <code class="docutils literal notranslate"><span class="pre">string{int32}</span></code> Robot Raconteur type. The function
<code class="docutils literal notranslate"><span class="pre">get_Webcams</span></code> implements the <code class="docutils literal notranslate"><span class="pre">Webcams</span></code> objref. Note that the objref is implemented by prepending <code class="docutils literal notranslate"><span class="pre">get\_</span></code> to the name
of the objref member. The index may come as a <code class="docutils literal notranslate"><span class="pre">string</span></code> even though an <code class="docutils literal notranslate"><span class="pre">int32</span></code> is expected, so convert the type to
<code class="docutils literal notranslate"><span class="pre">int</span></code> before using. When returning an object from an objref, it is necessary to return the fully qualified Robot
Raconteur type of the object as a second parameter.</p>
<p><strong>Note: objects can only be registered as a service object ONCE. Objects cannot be returned by two separate objrefs.
Objrefs must form a “tree” structure, where the child branches are the return objects from objrefs.</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">Webcam_impl</span></code> object implements the webcam functionality. The <code class="docutils literal notranslate"><span class="pre">CaptureFrame</span></code> function returns a single frame to
the client. The <code class="docutils literal notranslate"><span class="pre">StartStreaming</span></code> and <code class="docutils literal notranslate"><span class="pre">StopStreaming</span></code> functions begin or stop a thread implemented by the
<code class="docutils literal notranslate"><span class="pre">frame_threadfunc</span></code> function that sends streaming frames to the connected clients through the <code class="docutils literal notranslate"><span class="pre">FrameStream</span></code> pipe.</p>
<div class="line-block">
<div class="line">Pipes are very similar to wires, and are implemented using Python properties in a similar way. The
<code class="docutils literal notranslate"><span class="pre">FrameStream_pipeconnect</span></code> function adds the passed</div>
<div class="line">PipeEndpoint to the dictionary of connected <code class="docutils literal notranslate"><span class="pre">PipeEndpoint</span></code>s. While a wire can only have one <code class="docutils literal notranslate"><span class="pre">WireConnection</span></code>
client/server pair per client, pipes can have “indexed” <code class="docutils literal notranslate"><span class="pre">PipeEndpoints</span></code> meaning a single client can have multiple
<code class="docutils literal notranslate"><span class="pre">PipeEndpoint</span></code> client/server pairs per client. They are “indexed”, meaning a <code class="docutils literal notranslate"><span class="pre">PipeEndpoint</span></code> is defined by the
Robot Raconteur client endpoint (not to be confused with the PipeEndpoint) and the index of the <code class="docutils literal notranslate"><span class="pre">PipeEndpoint</span></code>.</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code> is used for this example. The <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code> is similar to the <code class="docutils literal notranslate"><span class="pre">WireBroadcaster</span></code>, sending
packets to all connected clients. While a <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code> can be inferred for a <code class="docutils literal notranslate"><span class="pre">readonly</span></code> pipe and the attribute
set in the same manner as a <code class="docutils literal notranslate"><span class="pre">WireBroadcaster</span></code>, for this example the <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code> is initialized by the object
so the <code class="docutils literal notranslate"><span class="pre">backlog</span></code> can be specified. The <code class="docutils literal notranslate"><span class="pre">backlog</span></code> is used for flow control. If there are more packets “in-flight”
than the specified maximum, more will not be sent. The property “FrameStream” is implemented, with the getter
initializing the <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code>. The function <code class="docutils literal notranslate"><span class="pre">frame_threadfunc</span></code> demonstrates using the <code class="docutils literal notranslate"><span class="pre">PipeBroadcaster</span></code> to
send frames to the clients.</p>
<div class="line-block">
<div class="line">The final members of interest in the <code class="docutils literal notranslate"><span class="pre">WebcamService</span></code> are the two memories, <code class="docutils literal notranslate"><span class="pre">buffer</span></code> and</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">multidimbuffer</span></code>. These two members demonstrate how to use two flavors of memories that are either single
dimensional or multi-dimensional. Memories are useful when data greater than about 10 MB needs to be transmitted
between client and server, when there is a random-access block of memory, or in the future for shared memory
applications. The function <code class="docutils literal notranslate"><span class="pre">CaptureFrameToBuffer</span></code> captures the data and saves it to the buffers. Note that
multi-dimensional arrays in Python are simply multi-dimensional NumPy arrays. Some processing is done to place the
data in “Matlab” style image formats. A structure of type “experimental.createwebcam.WebcamImage_size” is returned to
tell the client how big the image is.</div>
</div>
<p>The two memories are implemented in Python using properties. The <code class="docutils literal notranslate"><span class="pre">buffer</span></code> member returns an <code class="docutils literal notranslate"><span class="pre">ArrayMemory</span></code> object,
and the <code class="docutils literal notranslate"><span class="pre">multidimbuffer</span></code> returns a <code class="docutils literal notranslate"><span class="pre">MultiDimArrayMemory</span></code> object. Both contain their respective array and
multi-dimensional array. In this example a new memory object is returned every time. This is not generally the best way
to use the memory; instead, a persistent memory object should be used with a persistent memory block.</p>
</div>
<div class="section" id="webcam-client">
<h2>Webcam Client<a class="headerlink" href="#webcam-client" title="Permalink to this headline">¶</a></h2>
<p>Example <a class="reference external" href="https://github.com/robotraconteur/RobotRaconteur_Python_Examples/blob/master/SimpleWebcamClient.py">SimpleWebcamClient.py</a>
on GitHub is a program that will read the webcams and display the images. The
initialization and connection are similar to the iRobot Create example. The main difference is the use of the “objrefs”,
which are used to get references to the webcams <code class="docutils literal notranslate"><span class="pre">c1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">c1=c_host.get_Webcams(0)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">c2=c_host.get_Webcams(1)</span></code></p>
<p>The rest of the program deals with OpenCV related functions to show the images.</p>
</div>
<div class="section" id="webcam-client-streaming">
<h2>Webcam Client (streaming)<a class="headerlink" href="#webcam-client-streaming" title="Permalink to this headline">¶</a></h2>
<p>Example <a class="reference external" href="https://github.com/robotraconteur/RobotRaconteur_Python_Examples/blob/master/SimpleWebcamClient_streaming.py">SimpleWebcamClient_streaming.py</a>
is a program that provides a “live” view of the
camera, although depending on the speed of the computer it may be fairly slow because Python is an interpreted language.
The program connects and retrieves the webcam object reference <code class="docutils literal notranslate"><span class="pre">c</span></code> the same way as the previous example, and the
connects to the pipe <code class="docutils literal notranslate"><span class="pre">FrameStream</span></code>. The pipe index is given as the argument, and -1 means <em>any index</em>.</p>
<p><code class="docutils literal notranslate"><span class="pre">p=c.FrameStream.Connect(-1)</span></code></p>
<p>Next, a callback is added so that the function <code class="docutils literal notranslate"><span class="pre">new_frame</span></code> will be called when a new pipe packet arrives.</p>
<p><code class="docutils literal notranslate"><span class="pre">p.PacketReceivedEvent+=new_frame</span></code></p>
<p>This function will be called from a different thread by Robot Raconteur when a new frame has arrived. In the
<code class="docutils literal notranslate"><span class="pre">new_frame</span></code> function, the variable <code class="docutils literal notranslate"><span class="pre">current_frame</span></code> is updated with the new value. The <code class="docutils literal notranslate"><span class="pre">Available</span></code> property in the
PipeEndpoint provides the number of packets waiting, and the <code class="docutils literal notranslate"><span class="pre">ReceivePacket</span></code> retrieves the next packet. Packets always
arrive in order.</p>
<p>The rest of the program handles showing the images as they arrive and shutting down, including closing the pipe.</p>
<p><code class="docutils literal notranslate"><span class="pre">p.Close()</span></code></p>
</div>
<div class="section" id="webcam-client-memory">
<h2>Webcam Client (memory)<a class="headerlink" href="#webcam-client-memory" title="Permalink to this headline">¶</a></h2>
<p>Example <a class="reference external" href="https://github.com/robotraconteur/RobotRaconteur_Python_Examples/blob/master/SimpleWebcamClient_memory.py">SimpleWebcamClient_memory.py</a>
on GitHub demonstrates the use of the memories. The memories have
functions <code class="docutils literal notranslate"><span class="pre">Read</span></code> and <code class="docutils literal notranslate"><span class="pre">Write</span></code> that allow for a segment of the memory to be read or written into or from a buffer. The
memory position, buffer, buffer position, and count are passed. For multi-dimensional arrays, the memory position,
buffer position, and count are lists. The ArrayMemory has the special property “Length” for the length of the array, and
the MultiDimArrayMemory has the special properties <code class="docutils literal notranslate"><span class="pre">Dims</span></code>, <code class="docutils literal notranslate"><span class="pre">DimCount</span></code>, and <code class="docutils literal notranslate"><span class="pre">Complex</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Discovery.html" class="btn btn-neutral float-right" title="Service Discovery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="iRobotCreatePythonExample.html" class="btn btn-neutral float-left" title="iRobot Create Python Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Wason Technology, LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>