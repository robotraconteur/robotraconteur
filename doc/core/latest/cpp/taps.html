<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Robot Raconteur Core C++ Library: Taps</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-icon.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Robot Raconteur Core C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Taps </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_C__Users_wasonj_Documents_RobotRaconteur2_robotraconteur_docs_common_taps"></a> Taps provide a way to record message traffic and log messages (aka log records) that pass through a node. This is intended to provide the ability to inspect the operation of the system, and record raw data from experiments. Taps are node specific, meaning that each node needs to have its data recorded. This is in contrast to rosbag, which passively records an entire system. Robot Raconteur is an ad-hoc system, with no specific "master" to coordinate this behavior.</p>
<h1>Local Taps</h1>
<p>Currently, Robot Raconteur provides "local" taps. These function by opening a Unix socket on the local filesystem, with permissions allowing the current user to open the socket. The node will passively transmit log records and optionally message traffic to any clients that connect to the socket. A separate program is used to record these messages to file, and optionally to forward to a central repository.</p>
<p>The data is sent in Message V2 format, with each message starting with the magic "RRAC" and the length of the message encoded as a little-endian <code>uint32</code>. See the "Robot Raconteur Message Version 2 Serialization Format" standard for more details. Log records are encoded as a <code>MessageEntry(EntryType=MessageEntryType.StreamOp,EntryName="logrecord")</code> with each field of the record stored as a message element. See [Logging](Logging) for more details on the format of the log record.</p>
<h1>Enabling Local Tap</h1>
<p>Local taps can be enabled using command line options. Each tap needs a "name", which is used to identify the tap. This name is used with the recorders to identify nodes, and also to name the files. Names must be unique. Starting another tap with the same name may fail silently or have undefined behavior. To avoid this, it is suggested that the NodeName be used.</p>
<p>Example of starting a tap: </p><pre class="fragment">./my_robotraconteur_driver --robotraconteur-local-tap-enable=true --robotraconteur-local-tap-name=my_robot_1
</pre><h1>Tap for Python client</h1>
<p>The convenience module <code>RobotRaconteur.Client</code> does not read command line options. <code>ClientNodeSetup</code> must be used instead. The following will provide equivalent behavior to <code>RobotRaconteur.Client</code>, but provide command line option parsing: </p><pre class="fragment">import RobotRaconteur as RR
RRN=RR.RobotRaconteurNode.s
import sys

main():
    with RR.ClientNodeSetup(argv=sys.argv):
        # Put your main code here!

if __name__ == "__main__":
    main()
</pre><h1>Recording Local Taps</h1>
<p>The <a href="https://github.com/robotraconteur/RobotRaconteurLocalTapRecorder">RobotRaconteurLocalTapRecorder</a> utility can be used to save the output of local taps. To start it, use the following command: </p><pre class="fragment">dotnet RobotRaconteurLocalTapRecorder.dll
</pre><p>By default, the utility will save the contents of all taps to the current directory. It has the following options:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&ndash;tap-name=  </td><td class="markdownTableBodyNone">The name of the tap to record, if not specified records all   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">&ndash;output-dir=  </td><td class="markdownTableBodyNone">The directory to store output, if not specified current directory is used   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">&ndash;log-record-only  </td><td class="markdownTableBodyNone">Only record log messages, do not record message traffic   </td></tr>
</table>
<h1>Tap Playback</h1>
<p>A module in Python has been provided for playing back message taps. This example will read and print the <code>MemberName</code>of each <code>MessageEntry</code> in a file: </p><pre class="fragment">import RobotRaconteur as RR

fname = r"my_robot_1-2020-05-21 22-46-00.robtap"

with open(fname,"rb") as f:
    reader = RR.TapFileReader(f)
    while True:
        m = reader.ReadNextMessage()
        if m is None:
            break
        entry = m.entries[0]
        print (entry.MemberName)
</pre><p>The following is a more sophisticated example that prints the message field of log records: </p><pre class="fragment">import RobotRaconteur as RR

fname = r"my_robot_1-2020-05-21 22-46-00.robtap"

with open(fname,"rb") as f:
    reader = RR.TapFileReader(f)
    while True:
        m = reader.ReadNextMessage()
        if m is None:
            break
        entry = m.entries[0]
        print (entry.MemberName)
        if (entry.MemberName == "logrecord"):
            for i in range(len(entry.elements)):
                el = entry.elements[i]
                if el.ElementName == "message":
                    val = reader.UnpackMessageElement(el)
                    print(val.data)
</pre><p>This program uses <code>UnpackMessageElement()</code> to read the contents of a message element. Message elements contain the data and parameters that are passed between members. <code>UnpackMessageElement()</code> can be used to recover the packed data in the form of <code>VarValue</code>. Use <code>val.datatype</code> to query the type returned, and <code>val.data</code> to retrieve the value. If <code>struct</code>, <code>pod</code>, or <code>namedarray</code> are used, the service type must first be registered using <code>RRN.RegisterServiceType()</code> or <code>RRN.RegisterServiceTypeFromFile()</code> so the system knows how to unpack the types. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
