<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Robot Raconteur Core C++ Library: C++ Node Setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-icon.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Robot Raconteur Core C++ Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">C++ Node Setup </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_C__Users_wasonj_Documents_RobotRaconteur2_robotraconteur_docs_cpp_cpp_node_setup"></a> Robot Raconteur nodes must be set up before they can be used to create or accept connections. The following steps must be completed to set up a node:</p>
<ol type="1">
<li>Configure log levels and configure taps</li>
<li>Initialize and register service type factories</li>
<li>Initialize, configure, and register transports</li>
<li>Configure timeouts (optional)</li>
</ol>
<p>Once steps 1-4 are complete, services can be registered or client connections initiated. When it is time to shut down the program, the node must be shut down before freeing the node.</p>
<p>A helper class <a class="el" href="class_robot_raconteur_1_1_robot_raconteur_node_setup.html" title="Setup a node using specified options and manage node lifecycle.">RobotRaconteur::RobotRaconteurNodeSetup</a> and several subclasses are available to simplify the process of setting up and shutting down nodes. These classes take flags, arguments, and command line options to configure the node. See <a class="el" href="class_robot_raconteur_1_1_robot_raconteur_node_setup.html" title="Setup a node using specified options and manage node lifecycle.">RobotRaconteur::RobotRaconteurNodeSetup</a> for more information on the available flags, options, and subclasses. Command line options allow the user to override the default settings when starting the program. See <a class="el" href="command_line_options.html">Command Line Options</a> for a list of the available options. This helper class and its subclasses set up the node on construction, and shut down the node when destructed (RAII design pattern).</p>
<p>The subclasses RobotRaconteurNode::ClientNodeSetup, <a class="el" href="class_robot_raconteur_1_1_server_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a server and client node.">RobotRaconteur::ServerNodeSetup</a>, and <a class="el" href="class_robot_raconteur_1_1_secure_server_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a secure server and client nod...">RobotRaconteur::SecureServerNodeSetup</a> are typically used to set up the node. These classes configure the node with default options for client nodes, server nodes, and secure server nodes that require clients to use TLS. Server nodes are also configured to create client connections as well as accept incoming connections.</p>
<h1><a class="anchor" id="cpp_client_node_setup"></a>
Client Node Setup</h1>
<p>The class <a class="el" href="class_robot_raconteur_1_1_client_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a client only node.">RobotRaconteur::ClientNodeSetup</a> is used when the node is only required to create outgoing client connections. By default it configures the <code>TcpTransport</code>, <code>LocalTransport</code>, and <code>IntraTransport</code> transports and transport discovery. By default the <code>HardwareTransport</code> is disabled. It can be enabled using the <code>--robotraconteur-hardware-enable=true</code> command line option.</p>
<p>An example of a <code>main()</code> function using the <code>ClientNodeSetup</code>: </p><pre class="fragment">using namespace RobotRaconteur;
int main(int argc, char* argv)
{
    try
    {
        ClientNodeSetup node_setup(ROBOTRACONTEUR_SERVICE_TYPES, argc, argv);

        // Node is now ready to create connections

        auto c = RobotRaconteurNode::s()-&gt;ConnectService("rr+tcp://localhost:62222?service=my_service");

        // When node_setup is destroyed on scope exit, node is shut down
    }
    catch (std::exception&amp; exp)
    {
        std::cerr &lt;&lt; "Error occured in client: " &lt;&lt; string(exp.what()) &lt;&lt; std::endl;
        return -1;
    }
}
</pre><h1><a class="anchor" id="cpp_server_node_setup"></a>
Server Node Setup</h1>
<p><a class="el" href="class_robot_raconteur_1_1_server_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a server and client node.">RobotRaconteur::ServerNodeSetup</a> and <a class="el" href="class_robot_raconteur_1_1_secure_server_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a secure server and client nod...">RobotRaconteur::SecureServerNodeSetup</a> are similar to <a class="el" href="class_robot_raconteur_1_1_client_node_setup.html" title="Initializes a RobotRaconteurNode instance to default configuration for a client only node.">RobotRaconteur::ClientNodeSetup</a>, but take a default TCP port and a default NodeName as arguments to the constructor. </p><pre class="fragment">using namespace RobotRaconteur;
using namespace experimental::my_service
int main(int argc, char* argv)
{
    try
    {
        // Initialize service object

        auto my_service_obj = boost::make_shared&lt;MyServiceObject&gt;();

        ServerNodeSetup node_setup(ROBOTRACONTEUR_SERVICE_TYPES, "experimental.my_node", 62222, argc, argv);

        // Register the service to make it available to clients
        RobotRaconteurNode::s()-&gt;RegisterService("my_service", "experimental.my_service", my_service_obj);


        // Server node may also be used to create client connections

        auto c = RobotRaconteurNode::s()-&gt;ConnectService("rr+tcp://192.168.124.125:62222?service=my_service");

        // When node_setup is destroyed on scope exit, node is shut down
    }
    catch (std::exception&amp; exp)
    {
        std::cerr &lt;&lt; "Error occured in service: " &lt;&lt; string(exp.what()) &lt;&lt; std::endl;
        return -1;
    }
}
</pre><h1><a class="anchor" id="cpp_advanced_node_setup"></a>
Advanced Use of Node Setup</h1>
<p>The node setup classes shown above use default configurations. More advanced use cases are possible.</p>
<h2>Store Node Setup in Smart Pointer</h2>
<p>The node setup classes can be stored in a <code>boost::shared_ptr</code>. This may be necessary if Robot Raconteur is used as a plugin in a different program. The node setup class can be created using <code>boost::make_shared</code>, and then stored in a class field. When the pointer is reset, or the containing class is destroyed, the node setup will shut down the node. This is an example of "heap allocating" the node setup class, instead of "stack allocating" as shown above.</p>
<h2>Change Flags and Allowed Overrides</h2>
<p>The node setup classes use the flags in RobotRaconteur::RobotRaconteurNodeSetupFlags to control how the node is setup, and which options can be overridden from the command line. These flags are passed to the constructor of <a class="el" href="class_robot_raconteur_1_1_robot_raconteur_node_setup.html" title="Setup a node using specified options and manage node lifecycle.">RobotRaconteur::RobotRaconteurNodeSetup</a>. The client and server node setup subclasses use default flags. These flags can be customized to change how the node is initialized.</p>
<h2>Add Custom Command Line Options</h2>
<p>The class <a class="el" href="class_robot_raconteur_1_1_command_line_config_parser.html" title="Command line parser for node setup classes.">RobotRaconteur::CommandLineConfigParser</a> uses a default set up command line options. Custom options can be added to the parser, and read after node setup is complete. To use custom options, construct a <a class="el" href="class_robot_raconteur_1_1_command_line_config_parser.html" title="Command line parser for node setup classes.">RobotRaconteur::CommandLineConfigParser</a>, configure the default options flags, add the extra options, parse the command line, and pass the config parser to the RobotRaconteurNodeSetup constructor overload that accepts the config parser. This is only recommended for advanced use cases. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
